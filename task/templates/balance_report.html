{% extends "base.html" %}

{% block title %}Balance Report - Inventory Management{% endblock %}

{% block content %}
<div class="card mb-4">
    <div class="card-body d-flex flex-column flex-md-row align-items-start align-items-md-center justify-content-between gap-2">
        <h2 class="m-0 gradient-text"><i class="fas fa-chart-pie me-2"></i>Inventory Balance Report</h2>
        <div class="text-muted small">Generated on {{ generated_on.strftime('%B %d, %Y, %I:%M:%S %p') }}</div>
        <button onclick="window.print()" class="btn btn-secondary">
            <i class="fas fa-print me-1"></i> Print Report
        </button>
    </div>
</div>

<div class="card">
    <div class="card-header d-flex align-items-center gap-2">
        <h5 class="m-0"><i class="fas fa-warehouse me-2"></i>Current Stock Levels by Location</h5>
    </div>
    <div class="card-body">
        {% if balance_data %}
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th><i class="fas fa-box-open"></i> Product</th>
                        <th><i class="fas fa-map-location-dot"></i> Warehouse/Location</th>
                        <th class="text-center"><i class="fas fa-cubes"></i> Quantity</th>
                        <th><i class="fas fa-circle-info"></i> Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in balance_data %}
                    <tr>
                        <td>
                            <strong>{{ item.product.product_id }}</strong><br>
                            <small class="text-muted">{{ item.product.name }}</small>
                        </td>
                        <td>
                            <strong>{{ item.location.location_id }}</strong><br>
                            <small class="text-muted">{{ item.location.name }}</small>
                        </td>
                        <td class="text-center">
                            <span class="badge bg-{{ 'success' if item.balance > 0 else 'danger' }} fs-6">
                                {{ item.balance }}
                            </span>
                        </td>
                        <td>
                            {% if item.balance > 50 %}
                                <span class="badge bg-success">Well Stocked</span>
                            {% elif item.balance > 10 %}
                                <span class="badge bg-warning">Low Stock</span>
                            {% elif item.balance > 0 %}
                                <span class="badge bg-danger">Critical</span>
                            {% else %}
                                <span class="badge bg-dark">Out of Stock</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <!-- Summary Statistics -->
        <div class="row mt-4">
            <div class="col-md-3">
                <div class="card bg-primary text-white">
                    <div class="card-body text-center">
                        <h3>{{ balance_data|length }}</h3>
                        <p class="mb-0">Total Stock Items</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-success text-white">
                    <div class="card-body text-center">
                        <h3>{{ balance_data|selectattr('balance', 'gt', 50)|list|length }}</h3>
                        <p class="mb-0">Well Stocked</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-warning text-white">
                    <div class="card-body text-center">
                        <h3>{{ balance_data|selectattr('balance', 'le', 50)|selectattr('balance', 'gt', 10)|list|length }}</h3>
                        <p class="mb-0">Low Stock</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-danger text-white">
                    <div class="card-body text-center">
                        <h3>{{ balance_data|selectattr('balance', 'le', 10)|list|length }}</h3>
                        <p class="mb-0">Critical/Out</p>
                    </div>
                </div>
            </div>
        </div>
        
        {% else %}
        <div class="alert alert-info text-center">
            <i class="fas fa-info-circle fa-2x mb-3"></i>
            <h5>No Inventory Data Available</h5>
            <p>There are no product movements recorded yet, so no balance data is available.</p>
            <p>Start by:</p>
            <ol class="text-start">
                <li>Adding some <a href="{{ url_for('add_product') }}">products</a></li>
                <li>Creating <a href="{{ url_for('add_location') }}">locations</a></li>
                <li>Recording <a href="{{ url_for('add_movement') }}">product movements</a></li>
            </ol>
        </div>
        {% endif %}
    </div>
</div>

{% if balance_data %}
<div class="row mt-4">
    <div class="col-12">
        <div class="alert alert-light">
            <h6><i class="fas fa-circle-info"></i> Report Legend:</h6>
            <div class="row">
                <div class="col-md-3">
                    <span class="badge bg-success">Well Stocked</span> > 50 units
                </div>
                <div class="col-md-3">
                    <span class="badge bg-warning">Low Stock</span> 11-50 units
                </div>
                <div class="col-md-3">
                    <span class="badge bg-danger">Critical</span> 1-10 units
                </div>
                <div class="col-md-3">
                    <span class="badge bg-dark">Out of Stock</span> 0 units
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<style>
@media print {
    .btn, .navbar, footer, .alert-light {
        display: none !important;
    }
    .card {
        border: none !important;
        box-shadow: none !important;
    }
}
</style>
{% endblock %}
